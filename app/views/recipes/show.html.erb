<h2><%=@recipe.name %> </h2>
<h3>Created by: <%=link_to @recipe.user.name, user_recipes_path(@recipe.user)%> </h3>
<a href="#" class="js-next" data-id="<%=@recipe.id%>">Next...</a> <br>
<%= render partial: 'recipe_details', locals: {recipe: @recipe} %><br><br>

<% if policy(@recipe).update? %>
<%= link_to "Edit recipe", edit_recipe_path(@recipe) %>
<%= link_to "Delete recipe", "/recipes/#{@recipe.id}", method: "delete" %>
<% end %>
<script type="text/javascript" charset="utf-8">
let store = {recipes:[], ingredients:[], recipe_ingredients:[]}
class Recipe {
  constructor(recipe) {
    this.name = recipe.name
    this.prepTime = recipe.prep_time
    this.cookTime = recipe.cook_time
    this.image = recipe.image
    this.instructions = recipe.instructions
    this.ingredients = recipe.ingredients
    this.recipeIngredients = recipe.recipe_ingredients
    this.user = {id: recipe.user.id, name: recipe.user.first_name + " " + recipe.user.last_name}
    this.ingredientsList = function() {
      let array = [];
      //let recipeIngredients = th
        for(let i = 0; i < this.ingredients.length; i++) {
          array.push(this.recipeIngredients[i].quantity + " " + this.ingredients[i].name)
        }
        return array

    }
  }
}
class Ingredient {
  constructor(ingredient) {
    //debugger;
    this.id = ingredient.id
    this.name = ingredient.name
    store.ingredients.push(this)
  }
}
class RecipeIngredient {
  constructor(quantity, recipe, ingredient) {
    this.quantity = quantity
    this.recipeId = recipe.id
    this.ingredientId = ingredient.id
  }
}
$(function () {
  $(".js-next").on('click', function(e) {
    e.preventDefault();
    let nextId = parseInt($(this).attr("data-id")) + 1
    //debugger;
    $.getJSON(`/recipes/${nextId}`, function(rec) {
      recipe = new Recipe(rec)
      debugger;
      $('h2').text(recipe.name)
      $('h3 a').attr('href', `/users/${recipe.user.id}/recipes`)
      $('h3 a').text(recipe.user.name)
      $('img').attr('src', recipe.image)
    })
  })
})
</script>
